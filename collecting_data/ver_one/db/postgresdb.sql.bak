-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE public."CAMERA"
(
    id integer NOT NULL,
    ip character varying,
    location character varying,
    floor floor_name,
    width integer,
    height integer,
    department_id integer,
    comment character varying,
    PRIMARY KEY (id)
);

COMMENT ON COLUMN public."CAMERA".department_id
    IS 'some camera is fixed in a specific department';

COMMENT ON COLUMN public."CAMERA".comment
    IS 'for custom fields';

CREATE TABLE public."DEPARTMENT"
(
    id integer NOT NULL,
    name character varying,
    comment character varying,
    PRIMARY KEY (id)
);

CREATE TABLE public."FACE"
(
    id bigint NOT NULL,
    frameid bigint,
    nameid integer,
    trackid bigint,
    file_local character varying,
    file_remote character varying,
    detection_confident double precision,
    bbox_x1 double precision,
    bbox_y1 double precision,
    bbox_x2 double precision,
    bbox_y2 double precision,
    bbox_w double precision,
    bbox_h double precision,
    landmark character varying,
    isgood boolean,
    custom1 character varying,
    custom2 character varying,
    custom3 character varying,
    comment character varying,
    PRIMARY KEY (id)
);

COMMENT ON COLUMN public."FACE".file_local
    IS 'save in local filesystem';

COMMENT ON COLUMN public."FACE".file_remote
    IS 'save in S3 or something else';

CREATE TABLE public."FRAME"
(
    id bigint NOT NULL,
    src_id integer,
    frame_count integer,
    file_local character varying,
    file_remote character varying,
    comment character varying,
    PRIMARY KEY (id)
);

COMMENT ON COLUMN public."FRAME".file_local
    IS 'save in loca filesystem';

COMMENT ON COLUMN public."FRAME".file_remote
    IS 'save in S3 or something else';

COMMENT ON COLUMN public."FRAME".comment
    IS 'for custom fields';

CREATE TABLE public."STAFF"
(
    id integer NOT NULL,
    staff_id character varying,
    fullname character varying,
    department_id integer,
    num_good_face integer,
    comment character varying,
    PRIMARY KEY (id)
);

CREATE TABLE public."VIDEO_SRC"
(
    id integer NOT NULL,
    hash_md5 character varying,
    uri character varying NOT NULL,
    time_from timestamp without time zone,
    time_to timestamp without time zone,
    location character varying,
    width integer,
    height integer,
    duration integer,
    frame_count integer,
    wanted_people integer,
    camera_id integer,
    status character varying,
    comment character varying,
    PRIMARY KEY (id)
);

COMMENT ON COLUMN public."VIDEO_SRC".hash_md5
    IS 'to prevent duplicate video';

COMMENT ON COLUMN public."VIDEO_SRC".status
    IS 'done, not_started, started';

COMMENT ON COLUMN public."VIDEO_SRC".comment
    IS 'for custom fields';


ALTER TABLE public."CAMERA"
    ADD FOREIGN KEY (department_id)
    REFERENCES public."DEPARTMENT" (id)
    NOT VALID;


ALTER TABLE public."FACE"
    ADD FOREIGN KEY (frameid)
    REFERENCES public."FRAME" (id)
    NOT VALID;


ALTER TABLE public."FACE"
    ADD FOREIGN KEY (nameid)
    REFERENCES public."STAFF" (id)
    NOT VALID;


ALTER TABLE public."FRAME"
    ADD FOREIGN KEY (src_id)
    REFERENCES public."VIDEO_SRC" (id)
    NOT VALID;


ALTER TABLE public."STAFF"
    ADD FOREIGN KEY (department_id)
    REFERENCES public."DEPARTMENT" (id)
    NOT VALID;


ALTER TABLE public."VIDEO_SRC"
    ADD FOREIGN KEY (camera_id)
    REFERENCES public."CAMERA" (id)
    NOT VALID;


ALTER TABLE public."VIDEO_SRC"
    ADD FOREIGN KEY (wanted_people)
    REFERENCES public."STAFF" (id)
    NOT VALID;

END;